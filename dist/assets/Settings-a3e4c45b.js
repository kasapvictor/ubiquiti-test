import{q as _,k as e,B as E,l as g,n as u,p as b,G as C,F as M,X as F,ar as ne,f as D,h as x,a2 as T,a6 as ae,c as oe,i as j,A as p,Q as I,a3 as K,b as ie,a8 as y,a9 as N,o as P,N as Q,O as le,as as ce,E as X,P as k,T as v,r as J}from"./index-ed74213a.js";import{C as f,u as U,p as $}from"./immer.esm-44995c49.js";import{C as de}from"./CardWithStripe-a24946d3.js";import{E as S}from"./ErrorBlock-2b216bce.js";import{C as q}from"./ComponentWithLoader-fd42129e.js";import{T as Z}from"./Table-a93bceb9.js";import{C as h}from"./Center-3517d2ba.js";import{I as ue}from"./IconTrash-867080ac.js";import{i as me,a as w}from"./effector-react-0e880687.js";import{I as he,V as xe}from"./VerifyEmailForm-6fb13799.js";import{S as je}from"./SuccessBlock-d7ef8ef1.js";import{P as pe,I as L,a as R,b as B}from"./is-email-37029383.js";import{I as ge}from"./IconReload-e57a2e11.js";import{u as ee}from"./use-form-721559d2.js";import{I as fe}from"./IconMail-ecf3bd8a.js";import{m as we}from"./matches-field-125e59be.js";import{S as Y}from"./SimpleGrid-82ab373c.js";var Ce=_("download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]),Se=_("star-filled","IconStarFilled",[["path",{d:"M8.243 7.34l-6.38 .925l-.113 .023a1 1 0 0 0 -.44 1.684l4.622 4.499l-1.09 6.355l-.013 .11a1 1 0 0 0 1.464 .944l5.706 -3l5.693 3l.1 .046a1 1 0 0 0 1.352 -1.1l-1.091 -6.355l4.624 -4.5l.078 -.085a1 1 0 0 0 -.633 -1.62l-6.38 -.926l-2.852 -5.78a1 1 0 0 0 -1.794 0l-2.853 5.78z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),Ee=_("star","IconStar",[["path",{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z",key:"svg-0"}]]);const be=({resendFn:s,verifyFn:r,prevStep:t,verifyButtonText:o="Verify",resendButtonText:i="Resend",prevStepButtonText:l="Prev Step",notice:d="Notice about verify"})=>{const c=ye();return e.jsx(E,{mt:"md",children:e.jsx("form",{onSubmit:c.onSubmit(n=>{s.reset(),r.mutate(n)}),children:e.jsxs(g,{direction:"column",gap:"lg",align:"center",children:[e.jsx(pe,{autoFocus:!0,length:6,size:"lg",oneTimeCode:!0,type:"number",...c.getInputProps("pin"),disabled:r.isLoading||s.isLoading||r.isSuccess}),e.jsx(u,{type:"submit",size:"lg",fullWidth:!0,disabled:r.isLoading||s.isLoading||r.isSuccess,loading:r.isLoading,children:o}),e.jsx(b,{size:"sm",align:"center",color:"dimmed",children:d}),e.jsxs(C,{spacing:"md",children:[t&&e.jsx(u,{size:"xs",variant:"light",onClick:()=>t(),disabled:r.isLoading||s.isLoading||r.isSuccess,children:e.jsxs(C,{spacing:4,children:[e.jsx(he,{size:"0.75rem"}),l]})}),e.jsx(u,{size:"xs",variant:"light",onClick:()=>{r.reset(),s.mutate()},disabled:r.isLoading||s.isLoading||r.isSuccess,loading:s.isLoading,children:e.jsxs(C,{spacing:4,children:[i,e.jsx(ge,{size:"0.9rem"})]})})]})]})})})},ye=()=>ee({initialValues:{pin:""},validate:{pin:s=>`${s}`.length<M.PIN_MIN_LENGTH?"Incorrect":null}}),Ne=()=>e.jsx(e.Fragment,{children:e.jsx(F,{size:"lg",trigger:e.jsx(u,{size:"lg",children:"Add new card"}),title:"Add new card",children:e.jsx(de,{})})}),Le=()=>{var r;const s=ne();return s.isLoading?e.jsx(Pe,{}):s.isError?e.jsx(ve,{error:s.error}):!s.data||!((r=s.data)!=null&&r.length)?e.jsx(Ae,{}):e.jsx(f,{title:"Active cards",pb:0,children:e.jsxs(Z,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Brand"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Number"}),e.jsx("th",{children:e.jsx(h,{children:"Expires"})}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.data.map(t=>e.jsx(Ie,{card:t,cardCount:s.data.length},t.id))})]})})},Ie=({card:s,cardCount:r})=>{const t=D(),{classes:o,theme:i}=ke(),l=U(),d=x({mutationFn:()=>j({url:`${p.CARD.SET_AS_DEFAULT}/${s.id}`}),onSuccess:()=>{t.setQueryData([I.USER_CARDS],n=>$(n,a=>{a.map(m=>(m.id===s.id?m.default=1:m.default=0,m))}))},onError:n=>{l.error({message:n})}}),c=x({mutationFn:()=>j({url:`${p.CARD.REMOVE}/${s.id}`}),onSuccess:()=>{t.setQueryData([I.USER_CARDS],n=>{const a=n.filter(m=>m.id!==s.id);return s.default&&a[0]&&(a[0]={...a[0],default:1}),a})},onError:n=>{l.error({message:n})}});return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(b,{className:o.cardBrand,children:s.brand})}),e.jsx("td",{children:s.cardholder_name}),e.jsxs("td",{children:["**** **** **** ",s.last4]}),e.jsx("td",{children:e.jsxs(h,{children:[s.exp_month,"/",s.exp_year.slice(2,4)]})}),e.jsx("td",{children:e.jsxs(C,{spacing:"xl",position:"center",children:[e.jsx(T,{onClick:()=>r>1?d.mutate({}):!1,variant:s.default?"light":"subtle",c:s.default?i.colors.brand[9]:i.colors.gray[6],children:e.jsx(q,{isLoading:d.isLoading,component:s.default?e.jsx(Se,{size:"1rem"}):e.jsx(Ee,{size:"1rem"})})}),e.jsx(T,{onClick:()=>c.mutate({}),c:i.colors.gray[6],children:e.jsx(q,{isLoading:c.isLoading,component:e.jsx(ue,{size:"1rem"})})})]})})]})},Pe=()=>e.jsx(f,{title:"Active cards",withHeaderBottomBorder:!0,children:e.jsx(E,{px:"lg",pt:"md",children:e.jsxs(C,{pl:"sm",children:[e.jsx(b,{children:"Loading ..."})," ",e.jsx(ae,{size:"1rem"})]})})}),ve=({error:s})=>e.jsx(f,{title:"Active cards",withHeaderBottomBorder:!0,children:e.jsx(E,{px:"lg",children:e.jsx(S,{children:s})})}),Ae=()=>e.jsx(f,{title:"Active cards",withHeaderBottomBorder:!0,children:e.jsx(E,{px:"lg",pt:"md",children:e.jsx(b,{pl:"sm",children:"No actives cards. (will be deleted)"})})}),ke=oe(s=>({noContent:{border:`1px solid ${s.colors.brand[0]}`},cardBrand:{"&:first-letter":{textTransform:"uppercase"}}})),Re=[{id:1,description:"Charge for the tariff plan Business plan",amount:"$20",date:"01.02.03"},{id:2,description:"Charge for the tariff plan Business plan",amount:"$20",date:"01.03.03"},{id:3,description:"Charge for the tariff plan Business plan",amount:"$200",date:"01.04.03"},{id:4,description:"Charge for the tariff plan Business plan",amount:"$20",date:"01.05.03"}],Be=()=>e.jsx(f,{title:"Past Transactions",pb:0,children:e.jsxs(Z,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Payment Purpose"}),e.jsx("th",{children:e.jsx(h,{children:"Amount"})}),e.jsx("th",{children:e.jsx(h,{children:"Payment Date"})}),e.jsx("th",{children:e.jsx(b,{align:"center",children:"Download"})})]})}),e.jsx("tbody",{children:Re.map(s=>e.jsx(ze,{transaction:s},s.id))})]})}),ze=({transaction:s})=>{const{colors:r}=K();return e.jsxs("tr",{children:[e.jsx("td",{children:s.description}),e.jsx("td",{children:e.jsx(h,{children:s.amount})}),e.jsx("td",{children:e.jsx(h,{children:s.date})}),e.jsx("td",{children:e.jsx(h,{children:e.jsx(T,{children:e.jsx(Ce,{color:r.gray[6],size:ie(16)})})})})]})},Me=()=>e.jsx(f,{title:"Cards",titleSize:"lg",topButton:e.jsx(Ne,{}),withBackLink:!0,withBody:!0,children:e.jsxs(g,{direction:"column",gap:"lg",children:[e.jsx(Le,{}),e.jsx(Be,{})]})}),G=y(""),H=y(""),V=y(!1),{setFirstName:se}=N(G,{setFirstName:(s,r)=>r}),{setLastName:re}=N(H,{setLastName:(s,r)=>r}),{setIsLoading:z}=N(V,{setIsLoading:(s,r)=>r}),Te=({onSuccess:s,onError:r,onSettled:t}={})=>{const o=D(),[i,l]=me([G,H]),{name:d,surname:c}=P(),{isLoading:n,mutate:a}=x({networkMode:"always",mutationFn:()=>j({url:p.USER.CHANGE_PERSONAL_DATA,data:{name:i,surname:l}}),onSuccess:()=>{o.setQueryData([I.USER],A=>$(A,W=>{W.name=i,W.surname=l})),s&&s()},onError:A=>{r&&r(A)},onSettled:()=>{t&&t()}});return{isLoading:n,handleSave:()=>{if(i===d&&l===c)throw Error("Same values");return a()}}},_e=()=>{const{colors:s}=K(),r=Te({onSuccess:()=>{Q.show({color:"green.0",title:"Success",message:"Personal data changed",icon:e.jsx(le,{size:"1rem",color:s.green[5]})})},onError:o=>{Q.show({message:o,title:"Error",color:"pink.0",icon:e.jsx(ce,{size:"1rem",color:s.red[6]})})},onSettled:()=>{z(!1)}}),t=()=>{z(!0);try{r.handleSave()}catch{z(!1)}};return e.jsx(u,{size:"lg",onClick:t,disabled:r.isLoading,children:"Save"})},O=y(null),{setEmail:Fe,resetEmail:De}=N(O,{setEmail:(s,r)=>r,resetEmail:()=>null}),te=y(1),{nextStep:Ue,prevStep:$e,resetStep:Ge}=N(te,{nextStep:s=>s===1?s+1:s,prevStep:s=>s>1?s-1:s,resetStep:()=>1}),He=()=>x({networkMode:"always",mutationFn:({email:s})=>j({url:p.USER.CHANGE_EMAIL,data:{email:s,type:X.EMAIL_CHANGE}}),onSuccess:(s,r)=>{Fe(r.email),Ue()}}),Ve=()=>{const s=He();return e.jsxs(e.Fragment,{children:[s.error&&e.jsx(S,{reset:s.reset,children:s.error}),e.jsx(xe,{verifyFn:s,label:"New Email",buttonText:"Change"})]})},Oe=()=>{const s=w(O);return x({mutationFn:()=>j({url:p.USER.CHANGE_EMAIL,data:{email:s,type:X.EMAIL_CHANGE}}),networkMode:"always"})},We=()=>{const s=w(O),r=D(),t=U();return x({networkMode:"always",mutationFn:({pin:o})=>j({url:p.USER.VERIFY_NEW_EMAIL,data:{code:o}}),onSuccess:()=>{r.setQueryData([I.USER],o=>$(o,i=>{s&&(i.email=s)})),t.success({message:"Email changed!"})}})},Qe=({onClose:s})=>{const r=We(),t=Oe();return r.isSuccess&&s&&s(),e.jsxs(e.Fragment,{children:[r.error&&e.jsx(S,{reset:r.reset,children:r.error}),t.error&&e.jsx(S,{reset:t.reset,children:t.error}),t.isSuccess&&e.jsx(je,{reset:t.reset,children:"New code has been sent"}),e.jsx(be,{verifyFn:r,prevStep:$e,resendFn:t})]})},qe=()=>{const s=w(te),r=()=>{Ge(),De()};return e.jsx(F,{onCloseCallback:r,title:"Change email",trigger:e.jsx(u,{size:"xs",variant:"white",compact:!0,children:"Change"}),children:e.jsx(Ye,{step:s})})},Ye=({step:s,onClose:r})=>e.jsxs(e.Fragment,{children:[s===1&&e.jsx(Ve,{}),s===2&&e.jsx(Qe,{onClose:r})]}),Ke=({currentPassword:s,newPassword:r,confirmNewPassword:t})=>j({url:p.USER.CHANGE_PASSWORD,data:{old_password:s,new_password:r,new_password_confirmation:t}}),Xe=({onSuccess:s})=>{const r=U();return x({networkMode:"always",mutationFn:Ke,onSuccess:()=>{s&&s(),r.success({message:"Password changed!"})}})},Je=()=>ee({initialValues:{newPassword:"",currentPassword:"",confirmNewPassword:""},validate:{currentPassword:s=>s.length<M.PASSWORD_MIN_LENGTH?"Incorrect":null,newPassword:s=>s.length<M.PASSWORD_MIN_LENGTH?"Minimum 4 characters":null,confirmNewPassword:we("newPassword","Does not match")}}),Ze=({onClose:s})=>{const r=Je(),{isLoading:t,isError:o,error:i,isSuccess:l,mutate:d,reset:c}=Xe({onSuccess:s});return e.jsxs(e.Fragment,{children:[o&&e.jsx(E,{mb:"md",children:e.jsx(S,{reset:c,children:i})}),e.jsx("form",{onSubmit:r.onSubmit(n=>d(n)),children:e.jsxs(g,{direction:"column",gap:20,children:[e.jsx(k,{withAsterisk:!0,disabled:t||l,label:"Current password",icon:e.jsx(L,{size:"1rem"}),placeholder:"current password",...r.getInputProps("currentPassword"),visibilityToggleIcon:({reveal:n,size:a})=>n?e.jsx(R,{size:a}):e.jsx(B,{size:a})}),e.jsx(k,{withAsterisk:!0,disabled:t||l,label:"New password",icon:e.jsx(L,{size:"1rem"}),...r.getInputProps("newPassword"),placeholder:"password",visibilityToggleIcon:({reveal:n,size:a})=>n?e.jsx(R,{size:a}):e.jsx(B,{size:a})}),e.jsx(k,{withAsterisk:!0,disabled:t||l,label:"Confirm new password",icon:e.jsx(L,{size:"1rem"}),placeholder:"confirm new password",...r.getInputProps("confirmNewPassword"),visibilityToggleIcon:({reveal:n,size:a})=>n?e.jsx(R,{size:a}):e.jsx(B,{size:a})}),e.jsx(u,{fullWidth:!0,size:"lg",type:"submit",loading:t,disabled:l,children:"Change"})]})})]})},es=()=>e.jsx(F,{title:"Change password",trigger:e.jsx(u,{size:"xs",variant:"white",compact:!0,children:"Change"}),children:e.jsx(Ze,{})}),ss=()=>{const{email:s}=P();return e.jsxs(g,{gap:8,align:"start",direction:"column",children:[e.jsx(v,{label:"Email",value:s,disabled:!0,autoComplete:"off",placeholder:"yo@yo.com",sx:{width:"100%"},icon:e.jsx(fe,{size:"1rem"})}),e.jsx(qe,{})]})},rs=()=>{const{name:s}=P(),r=w(G);return J.useEffect(()=>{se(s)},[s]),r},ts=()=>{const s=w(V),r=rs();return e.jsx(v,{value:r,disabled:s,autoComplete:"off",label:"First Name",placeholder:"Name",onChange:t=>se(t.target.value)})},ns=()=>{const{surname:s}=P(),r=w(H);return J.useEffect(()=>{s&&re(s)},[s]),r},as=()=>{const s=w(V),r=ns();return e.jsx(v,{value:r,disabled:s,label:"Last Name",autoComplete:"off",placeholder:"Name",onChange:t=>re(t.target.value)})},os=()=>e.jsxs(g,{gap:8,align:"start",direction:"column",sx:{flex:1},children:[e.jsx(v,{disabled:!0,label:"Password",autoComplete:"off",value:"***********",placeholder:"password",icon:e.jsx(L,{size:"1rem"})}),e.jsx(es,{})]}),is=()=>e.jsx(f,{title:"Profile settings",titleSize:"lg",topButton:e.jsx(_e,{}),withBackLink:!0,withBody:!0,children:e.jsxs(g,{direction:"column",gap:20,children:[e.jsxs(Y,{cols:2,children:[e.jsx(ts,{}),e.jsx(as,{})]}),e.jsxs(Y,{cols:2,children:[e.jsx(ss,{}),e.jsx(os,{})]})]})}),Ns=()=>e.jsxs(g,{direction:"column",gap:"2rem",children:[e.jsx(is,{}),e.jsx(Me,{})]});export{Ns as default};

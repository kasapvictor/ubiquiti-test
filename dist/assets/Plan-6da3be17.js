import{b as g,c as P,g as X,r as C,u as J,R as Z,B as d,q as rr,a8 as er,a9 as sr,k as e,X as N,n as u,ar as z,G as f,p as l,a6 as S,f as L,h as A,o as _,a0 as I,i as j,A as y,Q as k,a3 as nr,l as x,O as tr,a1 as ir,D as w}from"./index-ed74213a.js";import{u as B,C as U,p as D,P as F}from"./immer.esm-44995c49.js";import{E as v}from"./ErrorBlock-2b216bce.js";import{a as or}from"./effector-react-0e880687.js";import{C as ar}from"./CardWithStripe-a24946d3.js";import{B as cr}from"./Badge-b46cd7ee.js";import{S as lr}from"./SimpleGrid-82ab373c.js";import{L as E}from"./List-1e4af68c.js";import{T as dr}from"./Title-f1bbc2af.js";import{I as ur}from"./IconMail-ecf3bd8a.js";import{D as mr}from"./Divider-278fae58.js";import"./get-styles-ref-1f22bf7e.js";var pr=Object.defineProperty,gr=Object.defineProperties,fr=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,hr=Object.prototype.hasOwnProperty,xr=Object.prototype.propertyIsEnumerable,O=(r,n,s)=>n in r?pr(r,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[n]=s,R=(r,n)=>{for(var s in n||(n={}))hr.call(n,s)&&O(r,s,n[s]);if($)for(var s of $(n))xr.call(n,s)&&O(r,s,n[s]);return r},jr=(r,n)=>gr(r,fr(n));const yr={xs:g(16),sm:g(20),md:g(26),lg:g(32),xl:g(40)},br=["filled","light","gradient","outline","default"];function Pr({theme:r,variant:n,color:s,gradient:t}){if(!br.includes(n))return null;const i=r.fn.variant({variant:n,color:s||r.primaryColor,gradient:t,primaryFallback:!1});return{backgroundColor:i.background,color:i.color,backgroundImage:n==="gradient"?i.background:void 0,border:`${g(n==="gradient"?0:1)} solid ${i.border}`}}var _r=P((r,{color:n,radius:s,gradient:t},{variant:i,size:a})=>{const o=X({size:a,sizes:yr});return{root:R(jr(R({},r.fn.fontStyles()),{display:"inline-flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box",width:o,height:o,minWidth:o,minHeight:o,borderRadius:r.fn.radius(s)}),Pr({theme:r,variant:i,gradient:t,color:n}))}});const vr=_r;var wr=Object.defineProperty,b=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,T=(r,n,s)=>n in r?wr(r,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[n]=s,Sr=(r,n)=>{for(var s in n||(n={}))M.call(n,s)&&T(r,s,n[s]);if(b)for(var s of b(n))W.call(n,s)&&T(r,s,n[s]);return r},Ir=(r,n)=>{var s={};for(var t in r)M.call(r,t)&&n.indexOf(t)<0&&(s[t]=r[t]);if(r!=null&&b)for(var t of b(r))n.indexOf(t)<0&&W.call(r,t)&&(s[t]=r[t]);return s};const Er={size:"md",variant:"filled"},q=C.forwardRef((r,n)=>{const s=J("ThemeIcon",Er,r),{className:t,size:i,radius:a,variant:o,color:c,children:h,gradient:m,unstyled:p}=s,K=Ir(s,["className","size","radius","variant","color","children","gradient","unstyled"]),{classes:V,cx:Y}=vr({variant:o,radius:a,color:c,gradient:m},{name:"ThemeIcon",unstyled:p,variant:o,size:i});return Z.createElement(d,Sr({className:Y(V.root,t),ref:n},K),h)});q.displayName="@mantine/core/ThemeIcon";var $r=rr("credit-card","IconCreditCard",[["path",{d:"M3 5m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M3 10l18 0",key:"svg-1"}],["path",{d:"M7 15l.01 0",key:"svg-2"}],["path",{d:"M11 15l2 0",key:"svg-3"}]]);const H=(r=null)=>{const n=r?new Date(r):new Date,s={month:"long",day:"numeric",year:"numeric"};return n.toLocaleDateString("en-US",s)},Q=er(!1),{setIsRecalculating:Or}=sr(Q,{setIsRecalculating:(r,n)=>n}),Rr=({variant:r,plan:n,titleButton:s})=>e.jsx(e.Fragment,{children:e.jsx(N,{size:"lg",trigger:e.jsx(u,{size:"lg",fullWidth:!0,variant:r,children:s||e.jsx(e.Fragment,{children:"Apply"})}),title:n.title,children:e.jsx(Tr,{plan:n})})}),Tr=({plan:r,onClose:n})=>{const s=z();if(s.isLoading)return e.jsxs(f,{spacing:"sm",children:[e.jsx(l,{children:"Loading..."}),e.jsx(S,{size:"xs"})]});if(s.isError)return e.jsx(v,{children:s.error});if(!s.data||!s.data.length)return e.jsx(ar,{onClose:n,onCloseOnAdded:!1});const t=s.data.find(i=>i.default)||s.data[0];return e.jsx(Cr,{onClose:n,plan:r,card:t})},Cr=({plan:r,card:n,onClose:s})=>{const t=B(),{classes:i,theme:a}=Lr(),o=L(),c=A({mutationFn:()=>j({url:`${y.USER.SUBSCRIBE_PLAN}/${r.id}`}),onSuccess:h=>{o.setQueryData([k.USER],m=>D(m,p=>{p.subscription=h.subscription})),s&&s(),t.success({message:`ðŸŽ‰ðŸŽ‰ðŸŽ‰ "${r.title}" subscribed!`})}});return e.jsxs(d,{sx:{position:"relative"},children:[e.jsxs(l,{mb:"md",children:["Lorem ipsum dolor sit amet, consectetur adipisicing elit. Architecto consequatur, deserunt ea ipsum mollitia provident soluta totam vero voluptatum. Ducimus + ",r.description]}),e.jsx(U,{children:e.jsxs(f,{position:"apart",px:"lg",pt:"lg",children:[e.jsxs(d,{children:[e.jsxs(f,{spacing:"sm",children:[e.jsx($r,{size:"1.2rem",color:a.colors.gray[6]}),e.jsxs(l,{color:a.colors.brand[9],fw:500,className:i.cardBrand,children:[n.brand," **** **** **** ",n.last4]})]}),e.jsxs(l,{fz:"sm",color:a.colors.gray[6],pl:"2rem",fw:500,children:["Expiry ",n.exp_month,"/",n.exp_year.slice(2,4)]})]}),e.jsx(Nr,{plan:r})]})}),c.isError&&e.jsx(v,{mb:"md",children:c.error}),e.jsxs(d,{mt:"md",children:[e.jsx(zr,{onClick:()=>c.mutate({}),isLoading:c.isLoading,plan:r}),e.jsx(u,{size:"lg",fullWidth:!0,variant:"light",onClick:s,children:"Cancel"})]})]})},Nr=({plan:r})=>{const{subscription:n}=_(),s=r.price,t=n.price||0,a=!!n.recurring&&t<s,o=I({queryKey:["recalculate-plan",r.id],queryFn:()=>j({url:`${y.USER.RECALCULATE_PLAN}/${r.id}`}),enabled:a,cacheTime:5*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,networkMode:"online"});C.useEffect(()=>{Or(o.isFetching)},[o.isFetching]);let c;return o.isLoading&&(c=e.jsx(S,{size:"xs"})),o.data&&a&&(c=`$${o.data}`),(o.isError||!a)&&(c=`$${r.price}`),e.jsx(cr,{size:"xl",fw:600,bg:"white",children:c})},zr=({onClick:r,isLoading:n,plan:s})=>{const{subscription:t}=_(),i=or(Q),a=s.price,o=t.price||0;let c="Pay Now";return o>a&&(c=`Downgrade plan from ${s.title}`),e.jsx(u,{size:"lg",fullWidth:!0,variant:"filled",mb:"md",onClick:r,disabled:i,loading:n,children:e.jsx(l,{mr:"xs",children:c})})},Lr=P(()=>({cardBrand:{"&:first-letter":{textTransform:"uppercase"}}})),Ar=()=>{const{black:r,colors:n}=nr(),s=I({queryKey:["plan-list"],queryFn:()=>j({url:y.USER.PLAN_LIST,method:ir.GET}),staleTime:1/0,cacheTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1});return s.isError?e.jsx(v,{children:s.error}):s.isLoading?e.jsxs(f,{spacing:"sm",children:[e.jsx(l,{children:"Loading..."}),e.jsx(S,{size:"xs"})]}):s.data.length?e.jsx(lr,{cols:3,spacing:"lg",children:s.data.map((t,i)=>e.jsx(F,{p:"lg",radius:"0.75rem",pb:"xl",children:e.jsxs(x,{direction:"column",align:"center",children:[e.jsxs(l,{fz:"2rem",weight:700,color:i===1?n.brand[9]:r,children:["$",t.price,"/mth"]}),e.jsx(l,{lh:2,align:"center",color:i===1?n.brand[9]:r,children:t.title}),e.jsx(l,{color:"dimmed",mb:"2rem",children:t.description}),e.jsx(E,{icon:e.jsx(q,{color:i===1?n.brand[9]:n.gray[0],children:e.jsx(tr,{size:"1rem",color:i===1?n.gray[0]:n.brand[9]})}),center:!0,spacing:"md",mb:"2rem",children:t.feature_list.map((a,o)=>e.jsx(E.Item,{children:a},o))}),e.jsx(kr,{plan:t,index:i})]})},t.id))}):e.jsx(e.Fragment,{children:e.jsx(l,{children:"No plans =("})})},kr=({plan:r,index:n})=>{var p;const{classes:s}=Br(),{subscription:t}=_(),i=r.id,a=t.tariff_id,o=!!t.recurring,c=t.downgrade,h=(p=t.downgrade)==null?void 0:p.id,m=H(t.expired);return c&&h===i?e.jsxs(d,{className:s.planInfo,children:["Start date of new plan: ",m]}):a===i&&o&&!c?e.jsxs(d,{className:s.planInfo,children:["Next renewal: ",m]}):a!==i||!o||c?e.jsx(Rr,{variant:n===1?"filled":"light",plan:r}):null},Br=P(r=>({planInfo:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"3.125rem",padding:"0 1.5rem",backgroundColor:r.colors.gray[1],borderRadius:r.defaultRadius,textAlign:"center",fontSize:r.fontSizes.sm,fontWeight:600}})),Ur=({planTitle:r})=>e.jsx(e.Fragment,{children:e.jsx(N,{size:"lg",title:"Unsubscribe",trigger:e.jsx(u,{size:"lg",variant:"light",children:"Unsubscribe"}),children:e.jsx(Dr,{planTitle:r})})}),Dr=({planTitle:r,onClose:n})=>{const s=B(),t=L(),i=A({mutationFn:()=>j({url:y.USER.CANCEL_PLAN}),onSuccess:a=>{t.setQueryData([k.USER],o=>D(o,c=>{c.subscription=a.subscription})),n&&n(),s.success({message:`ðŸ¥º "${r}" canceled!`})}});return e.jsxs(d,{children:[e.jsxs(l,{mb:"md",children:["ATANTION!!!! Lorem ipsum dolor sit amet, consectetur adipisicing elit. Architecto consequatur, deserunt ea ipsum mollitia provident soluta totam vero voluptatum. Ducimus + ",r]}),i.isError&&e.jsx(v,{mb:"md",children:i.error}),e.jsx(u,{size:"lg",mb:"md",fullWidth:!0,variant:"danger",loading:i.isLoading,onClick:i.mutate,children:"Are you very sure about that?"}),e.jsx(u,{size:"lg",fullWidth:!0,variant:"light",onClick:n,children:"Cancel"})]})},Fr=()=>{var t;const{classes:r,theme:n}=G(),{subscription:s}=_();return e.jsx(F,{p:"lg",mb:"0.325rem",children:e.jsxs(x,{justify:"space-between",children:[e.jsxs(x,{direction:"column",children:[e.jsxs(x,{gap:"md",mb:"xs",children:[e.jsx(dr,{order:1,color:n.colors.brand[9],children:s.tariff}),e.jsxs(f,{align:"center",p:"xs",className:r.sentEmailsWrapper,children:[e.jsx(l,{color:"dimmed",pl:"sm",children:"Sent emails"}),e.jsxs(f,{spacing:"xs",className:r.sentEmailsCountWrapper,children:[e.jsx(ur,{size:"1rem"}),e.jsxs(l,{weight:500,children:[s.sent_emails||0,"/",s.allowed_emails||0]})]})]})]}),e.jsx(Mr,{subscription:s})]}),(!!s.recurring||s.downgrade)&&e.jsx(Ur,{planTitle:((t=s.downgrade)==null?void 0:t.tariff)||s.tariff})]})})},Mr=({subscription:r})=>{const{classes:n}=G(),{data:s}=z(),t=s==null?void 0:s.find(a=>a.default),i=H(r.expired);return r.downgrade?e.jsx(w,{className:n.description,children:e.jsx("div",{dangerouslySetInnerHTML:{__html:`Start date of new <strong>'${r.downgrade.tariff}'</strong> with
            <strong>$${r.downgrade.price}</strong> per month on <strong>${i}</strong>,
            from <strong class="brand">${t==null?void 0:t.brand}</strong> ending in <strong>**** **** **** ${(t==null?void 0:t.last4)||"0000"}</strong>`}})}):r.expired?e.jsx(w,{className:n.description,children:e.jsx("div",{dangerouslySetInnerHTML:{__html:`Start to <strong>'${r.price}'</strong> per month and will renew on <strong>${i}</strong>,
            from <strong class="brand">${t==null?void 0:t.brand}</strong> ending in <strong>**** **** **** ${(t==null?void 0:t.last4)||"0000"}</strong>`}})}):e.jsx(w,{className:n.description,children:e.jsx("div",{dangerouslySetInnerHTML:{__html:"This is FREE plan description."}})})},G=P(r=>({sentEmailsWrapper:{backgroundColor:r.colors.gray[0],borderRadius:r.defaultRadius},sentEmailsCountWrapper:{padding:`0.4rem ${r.spacing.xs}`,color:r.colors.brand[0],backgroundColor:r.colors.brand[9],borderRadius:r.radius.md},description:{color:r.colors.gray[7],".brand":{display:"inline-block","&:first-letter":{textTransform:"uppercase"}}}})),se=()=>e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Plans",titleSize:"lg",withBackLink:!0,withBody:!0,children:e.jsxs(x,{direction:"column",gap:"md",children:[e.jsx(Fr,{}),e.jsx(Ar,{})]})}),e.jsx(mr,{my:50}),e.jsx(Wr,{})]}),Wr=()=>{const r=I({queryKey:["plan-import"],queryFn:()=>j({url:y.USER.PLAN_IMPORT}),staleTime:1/0,cacheTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1,enabled:!1});return e.jsx(u,{onClick:()=>r.refetch(),children:"Import Plan (admin)"})};export{se as default};

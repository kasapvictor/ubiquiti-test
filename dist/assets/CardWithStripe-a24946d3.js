import{c as ye,an as Be,r as I,u as De,R as i,au as Fe,B as he,a6 as ge,av as $e,aw as u,f as Ue,h as ze,i as Se,A as Ce,Q as Me,k as l,l as Q,p as D,T as qe,G as Ee,n as ae,a0 as Ke,a1 as Ge}from"./index-ed74213a.js";import{u as He,C as Ye}from"./immer.esm-44995c49.js";import{E as Qe}from"./ErrorBlock-2b216bce.js";var Ve=Object.defineProperty,Je=Object.defineProperties,Xe=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,er=Object.prototype.propertyIsEnumerable,se=(t,e,r)=>e in t?Ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rr=(t,e)=>{for(var r in e||(e={}))Ze.call(e,r)&&se(t,r,e[r]);if(oe)for(var r of oe(e))er.call(e,r)&&se(t,r,e[r]);return t},tr=(t,e)=>Je(t,Xe(e)),nr=ye(t=>({root:tr(rr({},t.fn.cover()),{display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"})}));const ar=nr;var or=Object.defineProperty,sr=Object.defineProperties,ir=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,ie=(t,e,r)=>e in t?or(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,F=(t,e)=>{for(var r in e||(e={}))be.call(e,r)&&ie(t,r,e[r]);if(M)for(var r of M(e))xe.call(e,r)&&ie(t,r,e[r]);return t},lr=(t,e)=>sr(t,ir(e)),cr=(t,e)=>{var r={};for(var n in t)be.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&M)for(var n of M(t))e.indexOf(n)<0&&xe.call(t,n)&&(r[n]=t[n]);return r};const ur={overlayOpacity:.75,transitionDuration:0,radius:0,zIndex:Be("overlay")},Oe=I.forwardRef((t,e)=>{const r=De("LoadingOverlay",ur,t),{className:n,visible:a,loaderProps:o,overlayOpacity:c,overlayColor:f,transitionDuration:s,exitTransitionDuration:h,zIndex:E,style:g,loader:S,radius:_,overlayBlur:j,unstyled:b,variant:m,keepMounted:x}=r,R=cr(r,["className","visible","loaderProps","overlayOpacity","overlayColor","transitionDuration","exitTransitionDuration","zIndex","style","loader","radius","overlayBlur","unstyled","variant","keepMounted"]),{classes:A,cx:y,theme:k}=ar(null,{name:"LoadingOverlay",unstyled:b,variant:m}),v=`calc(${E} + 1)`;return i.createElement(Fe,{keepMounted:x,duration:s,exitDuration:h,mounted:a,transition:"fade"},P=>i.createElement(he,F({className:y(A.root,n),style:lr(F(F({},P),g),{zIndex:E}),ref:e},R),S?i.createElement("div",{style:{zIndex:v}},S):i.createElement(ge,F({style:{zIndex:v}},o)),i.createElement($e,{opacity:c,zIndex:E,radius:_,blur:j,unstyled:b,color:f||(k.colorScheme==="dark"?k.colors.dark[5]:k.white)})))});Oe.displayName="@mantine/core/LoadingOverlay";function le(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ce(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?le(Object(r),!0).forEach(function(n){we(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function U(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?U=function(e){return typeof e}:U=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(t)}function we(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function z(t,e){return pr(t)||dr(t,e)||fr(t,e)||mr()}function pr(t){if(Array.isArray(t))return t}function dr(t,e){var r=t&&(typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"]);if(r!=null){var n=[],a=!0,o=!1,c,f;try{for(r=r.call(t);!(a=(c=r.next()).done)&&(n.push(c.value),!(e&&n.length===e));a=!0);}catch(s){o=!0,f=s}finally{try{!a&&r.return!=null&&r.return()}finally{if(o)throw f}}return n}}function fr(t,e){if(t){if(typeof t=="string")return ue(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ue(t,e)}}function ue(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function mr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V=function(e){var r=i.useRef(e);return i.useEffect(function(){r.current=e},[e]),r.current},L=function(e){return e!==null&&U(e)==="object"},vr=function(e){return L(e)&&typeof e.then=="function"},yr=function(e){return L(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},pe="[object Object]",hr=function t(e,r){if(!L(e)||!L(r))return e===r;var n=Array.isArray(e),a=Array.isArray(r);if(n!==a)return!1;var o=Object.prototype.toString.call(e)===pe,c=Object.prototype.toString.call(r)===pe;if(o!==c)return!1;if(!o&&!n)return e===r;var f=Object.keys(e),s=Object.keys(r);if(f.length!==s.length)return!1;for(var h={},E=0;E<f.length;E+=1)h[f[E]]=!0;for(var g=0;g<s.length;g+=1)h[s[g]]=!0;var S=Object.keys(h);if(S.length!==f.length)return!1;var _=e,j=r,b=function(x){return t(_[x],j[x])};return S.every(b)},Pe=function(e,r,n){return L(e)?Object.keys(e).reduce(function(a,o){var c=!L(r)||!hr(e[o],r[o]);return n.includes(o)?(c&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),a):c?ce(ce({},a||{}),{},we({},o,e[o])):a},null):null},gr="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",de=function(e){if(e===null||yr(e))return e;throw new Error(gr)},Sr=function(e){if(vr(e))return{tag:"async",stripePromise:Promise.resolve(e).then(de)};var r=de(e);return r===null?{tag:"empty"}:{tag:"sync",stripe:r}},J=i.createContext(null);J.displayName="ElementsContext";var Cr=function(e,r){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return e},X=i.createContext(null);X.displayName="CartElementContext";var Er=function(e,r){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return e},je=function(e){var r=e.stripe,n=e.options,a=e.children,o=i.useMemo(function(){return Sr(r)},[r]),c=i.useState(null),f=z(c,2),s=f[0],h=f[1],E=i.useState(null),g=z(E,2),S=g[0],_=g[1],j=i.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(n):null}}),b=z(j,2),m=b[0],x=b[1];i.useEffect(function(){var y=!0,k=function(P){x(function(N){return N.stripe?N:{stripe:P,elements:P.elements(n)}})};return o.tag==="async"&&!m.stripe?o.stripePromise.then(function(v){v&&y&&k(v)}):o.tag==="sync"&&!m.stripe&&k(o.stripe),function(){y=!1}},[o,m,n]);var R=V(r);i.useEffect(function(){R!==null&&R!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[R,r]);var A=V(n);return i.useEffect(function(){if(m.elements){var y=Pe(n,A,["clientSecret","fonts"]);y&&m.elements.update(y)}},[n,A,m.elements]),i.useEffect(function(){var y=m.stripe;!y||!y._registerWrapper||!y.registerAppInfo||(y._registerWrapper({name:"react-stripe-js",version:"2.1.0"}),y.registerAppInfo({name:"react-stripe-js",version:"2.1.0",url:"https://stripe.com/docs/stripe-js/react"}))},[m.stripe]),i.createElement(J.Provider,{value:m},i.createElement(X.Provider,{value:{cart:s,setCart:h,cartState:S,setCartState:_}},a))};je.propTypes={stripe:u.any,options:u.object};var q=function(e){var r=i.useContext(J);return Cr(r,e)},fe=function(e){var r=i.useContext(X);return Er(r,e)},br=function(){var e=q("calls useElements()"),r=e.elements;return r},xr=function(){var e=q("calls useStripe()"),r=e.stripe;return r};u.func.isRequired;var w=function(e,r,n){var a=!!n,o=i.useRef(n);i.useEffect(function(){o.current=n},[n]),i.useEffect(function(){if(!a||!e)return function(){};var c=function(){o.current&&o.current.apply(o,arguments)};return e.on(r,c),function(){e.off(r,c)}},[a,r,e,o])},Or=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},p=function(e,r){var n="".concat(Or(e),"Element"),a=function(s){var h=s.id,E=s.className,g=s.options,S=g===void 0?{}:g,_=s.onBlur,j=s.onFocus,b=s.onReady,m=s.onChange,x=s.onEscape,R=s.onClick,A=s.onLoadError,y=s.onLoaderStart,k=s.onNetworksChange,v=s.onCheckout,P=s.onLineItemClick,N=s.onConfirm,W=s.onCancel,Z=s.onShippingAddressChange,ke=s.onShippingRateChange,Ie=q("mounts <".concat(n,">")),K=Ie.elements,Ne=i.useState(null),ee=z(Ne,2),C=ee[0],Te=ee[1],T=i.useRef(null),G=i.useRef(null),re=fe("mounts <".concat(n,">")),H=re.setCart,Y=re.setCartState;w(C,"blur",_),w(C,"focus",j),w(C,"escape",x),w(C,"click",R),w(C,"loaderror",A),w(C,"loaderstart",y),w(C,"networkschange",k),w(C,"lineitemclick",P),w(C,"confirm",N),w(C,"cancel",W),w(C,"shippingaddresschange",Z),w(C,"shippingratechange",ke);var B;e==="cart"?B=function(ne){Y(ne),b&&b(ne)}:b&&(e==="expressCheckout"?B=b:B=function(){b(C)}),w(C,"ready",B);var Le=e==="cart"?function(O){Y(O),m&&m(O)}:m;w(C,"change",Le);var We=e==="cart"?function(O){Y(O),v&&v(O)}:v;w(C,"checkout",We),i.useLayoutEffect(function(){if(T.current===null&&K&&G.current!==null){var O=K.create(e,S);e==="cart"&&H&&H(O),T.current=O,Te(O),O.mount(G.current)}},[K,S,H]);var te=V(S);return i.useEffect(function(){if(T.current){var O=Pe(S,te,["paymentRequest"]);O&&T.current.update(O)}},[S,te]),i.useLayoutEffect(function(){return function(){T.current&&(T.current.destroy(),T.current=null)}},[]),i.createElement("div",{id:h,className:E,ref:G})},o=function(s){q("mounts <".concat(n,">")),fe("mounts <".concat(n,">"));var h=s.id,E=s.className;return i.createElement("div",{id:h,className:E})},c=r?o:a;return c.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onEscape:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,onNetworksChange:u.func,onCheckout:u.func,onLineItemClick:u.func,onConfirm:u.func,onCancel:u.func,onShippingAddressChange:u.func,onShippingRateChange:u.func,options:u.object},c.displayName=n,c.__elementType=e,c},d=typeof window>"u";p("auBankAccount",d);var me=p("card",d);p("cardNumber",d);p("cardExpiry",d);p("cardCvc",d);p("fpxBank",d);p("iban",d);p("idealBank",d);p("p24Bank",d);p("epsBank",d);p("payment",d);p("expressCheckout",d);p("paymentRequestButton",d);p("linkAuthentication",d);p("address",d);p("shippingAddress",d);p("cart",d);p("paymentMethodMessaging",d);p("affirmMessage",d);p("afterpayClearpayMessage",d);var _e="https://js.stripe.com/v3",wr=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ve="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Pr=function(){for(var e=document.querySelectorAll('script[src^="'.concat(_e,'"]')),r=0;r<e.length;r++){var n=e[r];if(wr.test(n.src))return n}return null},jr=function(e){var r=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(_e).concat(r);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},_r=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.54.0",startTime:r})},$=null,Rr=function(e){return $!==null||($=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe&&e&&console.warn(ve),window.Stripe){r(window.Stripe);return}try{var a=Pr();a&&e?console.warn(ve):a||(a=jr(e)),a.addEventListener("load",function(){window.Stripe?r(window.Stripe):n(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(o){n(o);return}})),$},Ar=function(e,r,n){if(e===null)return null;var a=e.apply(void 0,r);return _r(a,n),a},Re=Promise.resolve().then(function(){return Rr(null)}),Ae=!1;Re.catch(function(t){Ae||console.warn(t)});var kr=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];Ae=!0;var a=Date.now();return Re.then(function(o){return Ar(o,r,a)})};const Ir=({onClose:t,onCloseOnAdded:e=!0})=>{const r=Ue(),{classes:n,cx:a,theme:o}=Tr(),c=He(),f=xr(),s=br(),[h,E]=I.useState(""),[g,S]=I.useState(!1),[_,j]=I.useState(!1),[b,m]=I.useState(!1),[x,R]=I.useState(void 0),A=ze({mutationFn:v=>Se({url:Ce.CARD.ADD,data:v}),onSuccess:()=>{r.invalidateQueries([Me.USER_CARDS]).then(()=>{e&&t&&t(),c.clear(),c.success({message:"A new card has been added!"})})}}),y=v=>{var P;R((P=v.error)==null?void 0:P.message)},k=async v=>{if(v.preventDefault(),!f||!s||!h||x){h.length||S("Required!");return}const P=s.getElement(me);if(!P||x)return;j(!0);const{error:N,paymentMethod:W}=await f.createPaymentMethod({type:"card",card:P,billing_details:{name:h}});N?(j(!1),R(N.message)):await A.mutateAsync({stripe_id:W==null?void 0:W.id},{onSuccess:()=>{},onError:Z=>{j(!1)}})};return l.jsx("form",{onSubmit:k,children:l.jsxs(Q,{direction:"column",gap:"md",sx:{position:"relative"},children:[l.jsx(Oe,{visible:_,overlayBlur:2}),A.isError&&l.jsx(Qe,{mt:0,title:"Error",children:A.error}),l.jsxs(Ye,{pb:0,withBody:!0,withBorder:!1,shadow:"none",bodyWrapperNoPx:!0,children:[l.jsxs(Q,{direction:"column",children:[l.jsxs(D,{component:"label",htmlFor:"card-holder",className:a(n.label,{[n.labelError]:g}),children:["Card holder ",l.jsx("span",{children:"*"})]}),l.jsx(qe,{id:"card-holder",withAsterisk:!0,value:h,placeholder:"JOHN DOE",className:a(n.input,{[n.inputError]:g}),onChange:v=>{S(!1),E(v.target.value.toUpperCase())}}),g&&l.jsx(D,{className:a(n.errorText),children:g})]}),l.jsxs(Q,{direction:"column",mt:"md",children:[l.jsxs(D,{component:"label",htmlFor:"card-number",className:a(n.label,{[n.labelError]:x}),children:["Payment details ",l.jsx("span",{children:"*"})]}),l.jsx(he,{className:a(n.inputWrapper,{[n.inputWrapperFocus]:b,[n.inputWrapperError]:x}),children:l.jsx(me,{onChange:y,onFocus:()=>m(!0),onBlur:()=>m(!1),options:{...Nr({baseColor:o.black,placeholderColor:o.colors.gray[5],iconInvalidColor:o.colors.red[7]})}})}),x&&l.jsx(D,{className:a(n.errorText),children:x})]})]}),l.jsxs(Ee,{children:[l.jsx(ae,{size:"lg",fullWidth:!0,type:"submit",disabled:_||!f,children:"Add new card"}),l.jsx(ae,{size:"lg",fullWidth:!0,variant:"light",onClick:t,children:"Cancel"})]})]})})},Nr=({baseColor:t,placeholderColor:e,iconInvalidColor:r})=>({style:{base:{color:t,fontWeight:400,fontSize:"1.15rem",fontSmoothing:"antialiased",fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif","::placeholder":{color:e}},invalid:{iconColor:r,color:r,"::placeholder":{color:r}}}}),Tr=ye(t=>{const e=t.colors.red[7];return{input:{".mantine-Input-input":{fontWeight:400,letterSpacing:"0.2px",fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif"}},inputError:{".mantine-Input-input":{borderColor:e,"&::placeholder":{color:e}}},label:{fontSize:t.fontSizes.sm,color:t.colors.gray[6],marginBottom:"0.25rem",fontWeight:500,span:{color:t.colors.red[5],fontSize:t.fontSizes.sm}},labelError:{color:e},inputWrapper:{height:"3.125rem",border:"1px solid",borderColor:t.colors.gray[3],borderRadius:t.defaultRadius,backgroundColor:t.white,paddingTop:"0.85rem",paddingLeft:"calc(3.125rem / 3)",paddingRight:"calc(3.125rem / 3)",transition:"border-color .2s ease-in-out"},inputWrapperFocus:{borderColor:t.colors.brand[9]},inputWrapperError:{borderColor:e},inputWrapperDisabled:{filter:"grayscale(1)",background:t.colors.gray[0],opacity:.6},errorText:{paddingTop:"0.375rem",fontSize:t.fontSizes.sm,color:e,lineHeight:1}}}),Dr=({onClose:t,onCloseOnAdded:e})=>{const[r,n]=I.useState(null),a=Ke({queryKey:["stripe-public-key"],queryFn:()=>Se({url:Ce.CARD.STRIPE_PUBLIC_KEY,method:Ge.GET}),staleTime:1/0,cacheTime:1/0,refetchOnMount:!1,refetchOnWindowFocus:!1,networkMode:"offlineFirst",retry:1});return I.useEffect(()=>{a.data&&n(kr(a.data))},[a.data]),a.isLoading?l.jsxs(Ee,{spacing:"sm",children:["Loading a payment service... ",l.jsx(ge,{size:"xs"})]}):r?l.jsx(je,{stripe:r,children:l.jsx(Ir,{onClose:t,onCloseOnAdded:e})}):l.jsx(l.Fragment,{children:"Payment service unavailable."})};export{Dr as C};
